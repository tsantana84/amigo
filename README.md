# Secret Santa App

A simple Secret Santa web app built with Next.js and Supabase.

## Features

- Admin creates a group with participant names
- Generates a shareable link for the group
- Participants tap their name to reveal who they drew
- Mobile-friendly design

## Tech Stack

- **Next.js 14** (App Router, TypeScript)
- **Supabase** (Postgres database)
- **Vercel** (deployment)

## Setup

### 1. Create Supabase Project

1. Go to [supabase.com](https://supabase.com) and create a new project
2. Go to the SQL Editor and run the schema from `schema.sql`:

```sql
-- Groups table
CREATE TABLE groups (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  code TEXT UNIQUE NOT NULL,
  name TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Participants table
CREATE TABLE participants (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  group_id BIGINT NOT NULL REFERENCES groups(id) ON DELETE CASCADE,
  name TEXT NOT NULL
);

-- Pairs table (Secret Santa assignments)
CREATE TABLE pairs (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  group_id BIGINT NOT NULL REFERENCES groups(id) ON DELETE CASCADE,
  giver_id BIGINT NOT NULL REFERENCES participants(id) ON DELETE CASCADE,
  receiver_id BIGINT NOT NULL REFERENCES participants(id) ON DELETE CASCADE
);

-- Indexes
CREATE INDEX idx_participants_group_id ON participants(group_id);
CREATE INDEX idx_pairs_group_id ON pairs(group_id);
CREATE INDEX idx_pairs_giver_id ON pairs(giver_id);
CREATE INDEX idx_groups_code ON groups(code);
```

3. Go to Settings > API and copy your:
   - Project URL (`SUPABASE_URL`)
   - Service Role Key (`SUPABASE_SERVICE_ROLE_KEY`)

### 2. Local Development

1. Clone the repository
2. Install dependencies:
   ```bash
   npm install
   ```
3. Create `.env.local` with your Supabase credentials:
   ```
   SUPABASE_URL=your-supabase-url
   SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
   ```
4. Run the development server:
   ```bash
   npm run dev
   ```
5. Open [http://localhost:3000](http://localhost:3000)

### 3. Deploy to Vercel

1. Push your code to GitHub
2. Import the project in [Vercel](https://vercel.com)
3. Add environment variables:
   - `SUPABASE_URL`
   - `SUPABASE_SERVICE_ROLE_KEY`
4. Deploy

## Usage

1. Go to `/admin` to create a new Secret Santa group
2. Enter a group name and participant names (one per line)
3. Click "Create Group"
4. Copy the generated link and share it with participants
5. Each participant taps their name to see who they drew

## Project Structure

```
├── app/
│   ├── layout.tsx          # Root layout
│   ├── globals.css         # Global styles
│   ├── page.tsx            # Landing page
│   ├── admin/
│   │   ├── page.tsx        # Admin form
│   │   ├── route.ts        # POST handler for group creation
│   │   └── success/
│   │       └── page.tsx    # Success page with share link
│   └── g/
│       └── [code]/
│           ├── page.tsx    # Participant list
│           └── p/
│               └── [participantId]/
│                   └── page.tsx  # Result page
├── lib/
│   └── supabaseClient.ts   # Server-side Supabase client
├── schema.sql              # Database schema
└── package.json
```

## Security Notes

- The Supabase service role key is only used server-side
- RLS is disabled for simplicity in this prototype
- For production, consider adding RLS policies
